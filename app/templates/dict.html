<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dictation Board</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 50vh;
            width: 100vw;
            margin: 0;
            background-color: #f4f4f4;
        }
        .header {
            margin-bottom: 6vh;
            text-align: center;
        }
        .container {
            display: flex;
            flex-direction: column; /* Align items vertically */
            align-items: center;
            position: relative;
            border: 4px solid #007bff; /* Thicker blue border for the container */
            border-radius: 10px; /* Rounded corners */
            padding: 20px; /* Padding around the content */
            background-color: white; /* Background color for better contrast */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Subtle shadow for a lifted effect */
        }
        .controls {
            display: flex;
            align-items: center;
            margin-bottom: 30px; /* Space above the retry button */
        }
        .arrow {
            font-size: 2rem;
            cursor: pointer;
            user-select: none;
            border-radius: 5px; /* Rounded corners for arrows */
            margin: 0 10px; /* Space between arrows and board */
            background-color: white; /* Match button background */
        }
        .board-container {
            width: 110px;
            overflow: hidden;
            position: relative;
            margin: 0 20px;
        }
        .button-container {
            display: flex;
            justify-content: center;
            margin-top: 5vh;
        }
        .button-container button {
            margin: 0 5px;
        }
        .board {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }
        .sound-button {
            padding: 10px 20px;
            font-size: 1.9rem;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: 2px solid #0056b3; /* Darker border for buttons */
            border-radius: 5px;
            min-width: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
            margin: 0 5px;
        }
        .retry-button, .done-button {
            visibility: hidden; /* Initially hidden */
            padding: 10px 20px;
            font-size: 1.2rem;
            cursor: pointer;
            background-color: #28a745;
            color: white;
            border: 2px solid #1e7e34; /* Darker border for retry/done buttons */
            border-radius: 5px;
            margin-top: 10px;
        }

        .retry-button{
            background-color: red;
            border : 2px solid #750000;
        }

        .exit-button {
            padding: 5px 5px;
            font-size: 1.2rem;
            cursor: pointer;
            background-color: #dca735;
            color: white;
            border: 2px solid #ff9204; /* Darker border for retry/done buttons */
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h2>Press<i class="fa-solid fa-play"></i> to play each word!</h2><h2>点击<i class="fa-solid fa-play"></i> 播放每个单词</h2>
    </div>
    <div class="container">
        <div class="controls">
            <div class="arrow" id="leftArrow"><i class="fa-solid fa-arrow-left"></i></div>
            <div class="board-container">
                <div class="board" id="board"></div>
            </div>
            <div class="arrow" id="rightArrow"><i class="fa-solid fa-arrow-right"></i></div>
        </div>
        <div class="button-container" id="buttonContainer">
            <button class="retry-button" id="retryButton"><i class="fa-solid fa-rotate-right"> Retry </i></button>
            <button class="done-button" id="doneButton" onclick="window.location.href='/dictation_page.html'"><i class="fa-solid fa-check"> Done </i></button>
        </div>
    </div>
    <div class="button-container" id="buttonContainer">
        <button class="exit-button" id="exitButton"><i class="fa-solid fa-right-from-bracket"> Exit 离开</i></button>
    </div>
    
    
    <script>
        // Retrieve the stored form data
        const dictationData = JSON.parse(localStorage.getItem('dictationForm'));
    
        // // Get the words and language from the form data
        const words = dictationData.words.trim().split(/\n/); // Assuming words are space-separated
        const lang = dictationData.lang;
    
        // Get the board element
        const board = document.getElementById('board');
        const leftArrow = document.getElementById('leftArrow');
        const rightArrow = document.getElementById('rightArrow');
        const retryButton = document.getElementById('retryButton');
        const doneButton = document.getElementById('doneButton');
        const exitButton = document.getElementById('exitButton');
    
        // Function to create a button for each word
        function createWordButton(word) {
            const button = document.createElement('button');
            button.className = 'sound-button';
            button.innerHTML = '<i class="fa-solid fa-play"></i>'; // Keep text same for all buttons
            button.addEventListener('click', () => {
               playWord(word);
            });
            return button;
        }
    
        function playWord(word) {
            const dictationData = JSON.parse(localStorage.getItem('dictationForm'));
            const lang = dictationData.lang;
            fetch(`/play_word/${word}/${lang}`)
                .then(response => response.json())
                .then(() => {
                    const audio = new Audio(`static/audio/${word}_${lang}.mp3`);
                    audio.play();
                    audio.addEventListener('ended', function () {
                        fetch('/delete_audios.json');
                    });
                });
        }

        // Create and append buttons for all words
        words.forEach(word => {
            const wordButton = createWordButton(word);
            board.appendChild(wordButton);
        });
    
        // Initialize the current word index
        let currentIndex = 0;
    
        // Update the board position
        function updateBoard() {
            const translateX = -currentIndex * 110; // Adjust based on button width + margin
            board.style.transform = `translateX(${translateX}px)`;
            // Check if arrows should be shown or hidden
            leftArrow.style.visibility = currentIndex > 0 ? 'visible' : 'hidden';
            rightArrow.style.visibility = currentIndex < words.length - 1 ? 'visible' : 'hidden';
            retryButton.style.visibility = currentIndex === words.length - 1 ? 'visible' : 'hidden';
            doneButton.style.visibility = currentIndex === words.length - 1 ? 'visible' : 'hidden';
        }
    
        // Add event listeners to arrows
        leftArrow.addEventListener('click', () => {
            if (currentIndex > 0) {
                currentIndex--;
                updateBoard();
            }
        });
    
        rightArrow.addEventListener('click', () => {
            if (currentIndex < words.length - 1) {
                currentIndex++;
                updateBoard();
            }
        });
    
        retryButton.addEventListener('click', () => {
            currentIndex = 0; // Reset to the first item
            updateBoard();
        });
        
        exitButton.addEventListener('click', () => {
            window.location.href = '/dictation_page.html';
        });
        // Initial board update
        updateBoard();
    </script>
    
</body>
</html>
